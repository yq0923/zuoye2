
<html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="js/jquery-3.4.1.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->


<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/DataTables/DataTables-1.10.18/js/jquery.dataTables.js"></script>
<script src="js/DataTables/DataTables-1.10.18/js/dataTables.bootstrap.min.js"></script>
<script src="js/bootstrap3/js/bootstrap.min.js"></script>
<script src="js/bootstrap-datetimepicker/js/moment-with-locales.js"></script>
<script src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="js/bootbox/bootbox.min.js"></script>
<script src="js/fileinput5/js/fileinput.js"></script>
<script src="js/fileinput5/js/locales/zh.js"></script>
<link href="js/fileinput5/css/fileinput.css" rel="stylesheet">
<link href="js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">

<link href="js/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="js/bootstrap3/css/bootstrap.min.css">
<link rel="stylesheet" href="js/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.min.css">

<script type="text/html" id="updateShowDiv">

    <div>
        <form class="form-horizontal">

            <div class="form-group">
                <label  class="col-sm-2 control-label">电影名称:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="update_name" >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">评分:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="update_grade" >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">时长:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="update_mins" >
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">是否热映:</label>
                <label class="radio-inline">
                    <input type="radio" name="update_isHot"  value="1">热映
                </label>
                <label class="radio-inline">
                    <input type="radio" name="update_isHot" value="2">不热映
                </label>
                <br>

            </div>


            <div class="form-group">
                <label class="col-sm-2 control-label">电影类型:</label>
                <div class="col-sm-10">
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_type" value="1"> 恐怖
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_type" value="2"> 喜剧
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_type" value="3"> 科幻
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_type" value="4"> 动画
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_type" value="5"> 剧情
                    </label>
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-2 control-label">电影类型:</label>
                <div class="col-sm-10">
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_area" value="1"> 中国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_area" value="2"> 美国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_area" value="3"> 法国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_area" value="4"> 韩国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="update_area" value="5"> 英国
                    </label>
                </div>
            </div>


            <div class="form-group">
                <label  class="col-sm-2 control-label">上映时间:</label>
                <div class="col-sm-3">
                    <input type="text" id="update_showTime"  class="form-control"  >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">电影介绍:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="update_introduce" >
                </div>
            </div>
        </form>
    </div>
</script>

<script type="text/html" id="addShowDiv">
    <div>
        <form class="form-horizontal">

            <div class="form-group">
                <label  class="col-sm-2 control-label">电影名称:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="add_name" >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">评分:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="add_grade" >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">时长:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="add_mins" >
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">是否热映:</label>
                <label class="radio-inline">
                    <input type="radio" name="add_isHot"  value="1">热映
                </label>
                <label class="radio-inline">
                    <input type="radio" name="add_isHot" value="2">不热映
                </label>
                <br>

            </div>


            <div class="form-group">
                <label class="col-sm-2 control-label">电影类型:</label>
                <div class="col-sm-10">
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_type" value="1"> 恐怖
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_type" value="2"> 喜剧
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_type" value="3"> 科幻
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_type" value="4"> 动画
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_type" value="5"> 剧情
                    </label>
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-2 control-label">电影类型:</label>
                <div class="col-sm-10">
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_area" value="1"> 中国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_area" value="2"> 美国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_area" value="3"> 法国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_area" value="4"> 韩国
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="add_area" value="5"> 英国
                    </label>
                </div>
            </div>


            <div class="form-group">
                <label  class="col-sm-2 control-label">上映时间:</label>
                <div class="col-sm-3">
                    <input type="text" id="add_showTime"  class="form-control"  >
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">电影介绍:</label>
                <div class="col-sm-3">
                    <input type="text"  class="form-control" id="add_introduce" >
                </div>
            </div>
        </form>
    </div>
</script>

<script type="text/javascript">
    var table;

    $(function (){

        getPageData();
        queryTypeList();
        InitDate();
        queryAreaList()
    })
    function InitDate(){
        $('#minDate').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            locale: moment.locale('zh-cn'),

        })
        $('#maxDate').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            locale: moment.locale('zh-cn'),

        })
    }
    function addInitDate(){
        $('#add_showTime').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            locale: moment.locale('zh-cn'),

        })

    }
    function updateInitDate(){
        $('#update_showTime').datetimepicker({
            format: 'YYYY-MM-DD HH:mm:ss',
            locale: moment.locale('zh-cn'),

        })
    }

    function queryAreaList(){

        $.post(
            "http://localhost:8080/movie/queryAreaList",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#selectArea").html(str);

                }
            }
        )

    }
    function addAreaList(){

        $.post(
            "http://localhost:8080/movie/queryAreaList",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#add_area").html(str);

                }
            }
        )

    }


    function queryTypeList(){

        $.post(
            "http://localhost:8080/movie/queryTypeList",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#selectType").html(str);

                }
            }
        )

    }

    function addTypeList(){

        $.post(
            "http://localhost:8080/movie/queryTypeList",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#add_type").html(str);

                }
            }
        )

    }

    function updateTypeList(){
        $.ajaxSettings.async = false;
        $.post(
            "http://localhost:8080/movie/queryTypeList",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#update_type").html(str);

                }
            }
        )
        $.ajaxSettings.async = true;
    }

    function getPageData(){
        var buttons="";

        table=$('#example').DataTable({
            "processing": true,
            "serverSide": true,//开启服务的模式
            "ordering":false,
            "searching":false,
            "aLengthMenu": [5, 10, 15], //更改显示记录数选项
            "ajax": {
                "url": "http://localhost:8080/movie/queryList",
                "type": "POST",
                "data": function (d) {
                    //添加额外的参数传给服务器

              /*      d.movieName = $("#movieName").val();
                    d.minDate = $("#minDate").val();
                    d.maxDate = $("#maxDate").val();
                    d.typeId = $("#selectType").val();
                    d.country = $("[name='add_country']:checked").val();

*/
                },
                dataSrc:function(result) {
                    if(result.status=200){
                        result.draw=result.data.draw;
                        result.recordsTotal=result.data.recordsTotal;
                        result.recordsFiltered=result.data.recordsFiltered;
                        return result.data.data;
                    }else {
                        return "";
                    }


                }

            },
            "columns": [
                {"data": "id"},
                {"data": "name"},
                {"data": "mins"},
                {"data": "filePath"},
                {"data": "isHot",
                    render:function(data){
                        return data == 1?"热映":"不热映";
                    }},
                {"data": "areaName"},
                {"data": "typeName"},
                {"data": "grade"},
                {"data": "showTime",
                    render:function(data){
                        return new Date(data).toLocaleString();
                    }},
                {"data": "createTime",
                    render:function(data){
                        return new Date(data).toLocaleString();
                    }},
                {"data": "updateTime",
                    render:function(data){
                        return new Date(data).toLocaleString();
                    }},
                {"data": "introduce"},
                {"data": "id",render: function(data, type, row, meta) {

                            buttons = '<button type="button" class="btn btn-primary  btn-lg" onclick="toUpdate('+data+')"><li class="glyphicon glyphicon-pencil" ></li>&nbsp;修改</button> '+
                                      '<button type="button" class="btn btn-danger  btn-lg" onclick="deleteMenu('+data+')"><li class="glyphicon glyphicon-remove-sign" >&nbsp;</li>删除</button>';
                            return buttons;
                    }},

            ],

            "language": {                              // 这是修改语言的显示
                buttons: {
                    pageLength: {
                        _: "显示%d条",
                        '-1': "全部显示"
                    }
                },
                paginate: {
                    first: "首条",
                    previous: "前一页",
                    next: "下一页",
                    last: "末页"
                },
                "info": "第_PAGE_页,共_PAGES_页",
                "infoEmpty": "未找到相关数据",
                "search": "关键字",
                "zeroRecords": "未找到相关数据",
                "decimal": ".",
                "thousands": ",",

            },
        })
    }






    function toAdd(){


        bootbox.dialog({
            message: $("#addShowDiv").html(),
            title: "添加",
            buttons: {
                Cancel: {
                    label: "取消",
                    className: "btn-default",
                    callback: function () {
                        alert("操作终止");
                    }
                }
                , OK: {
                    label: "提交",
                    className: "btn-primary",
                    callback: function () {
                        var menu = {};
                        menu.name = $("#add_name").val();
                        menu.mins = $("#add_mins").val();
                        menu.isHot =  $("[name=add_isHot]:checked").val();
                        menu.grade =  $("#add_grade").val();
                        var type="";
                        $("[name=add_type]:checked").each(function () {
                            type+=this.value+",";
                        });
                        if(type!=null){
                            type=type.substring(0,type.length-1);
                        }
                        menu.typeId=type;

                        var area="";
                        $("[name=add_area]:checked").each(function () {
                            area+=this.value+",";
                        });
                        if(area!=null){
                            area=area.substring(0,area.length-1);
                        }
                        menu.areaId=area;

                        menu.introduce = $("#add_introduce").val();
                        menu.showTime = $("#add_showTime").val();
                        $.post(
                            "http://localhost:8080/movie/add",
                            menu,
                            function (data) {
                                if(data.status==200){
                                    alert("操作完成");
                                    queryList();
                                } else {
                                    bootbox.alert(
                                        "系统异常，请联系管理员",function() {

                                        }
                                    )
                                }
                            }
                        )
                    }
                }
            }
        });
        addInitDate();
    }

    function toUpdate(id){

        //  location.href="/menu/toUpdate?id="+id;
        bootbox.dialog({
            message:$("#updateShowDiv").html(),
            title: "修改",
            buttons: {
                success: {
                    label: "提交",
                    className: "btn-primary",
                    callback: function() {
                        var menu={};
                        menu.name = $("#update_name").val();
                        menu.mins = $("#update_mins").val();
                        menu.isHot =  $("[name=update_isHot]:checked").val();
                        menu.grade =  $("#update_grade").val();
                        var areaId = "";
                        $("[name=update_area]:checked").each(function(){
                            areaId += this.value + ",";
                        });
                        if(areaId != ""){
                            areaId = areaId.substring(0,areaId.length-1);
                        }
                        var typeId = "";
                        $("[name=update_type]:checked").each(function(){
                            typeId += this.value + ",";
                        });
                        if(typeId != ""){
                            typeId = typeId.substring(0,typeId.length-1);
                        }
                        menu.introduce = $("#update_introduce").val();
                        menu.showTime = $("#update_showTime").val();
                        menu.id=id;
                        $.post(
                            "http://localhost:8080/movie/update",
                            menu,
                            function(data){
                                if(data.status==200){
                                    queryList();
                                }else {
                                    bootbox.alert("操作失败,请联系管理员!",function(){

                                    });

                                }
                            })
                    }
                },
                danger: {
                    label: "取消",
                    className: "btn-default",
                    callback: function() {

                    }
                },

            }
        });

        $.post(
            "http://localhost:8080/movie/toUpdate",
            {"id":id},
            function (result){
                if(result.status==200){
                    var data=result.data;
                    var areaId = menu.areaId.split(",");
                    $("[name=update_area]").each(function(){
                        if(areaId.indexOf(this.value) != -1){
                            this.checked = true;
                        }
                    });
                    var typeId = menu.typeId.split(",");
                    $("[name=update_type]").each(function(){
                        if(typeId.indexOf(this.value) != -1){
                            this.checked = true;
                        }
                    });

               }
            }
        );



    }



    function queryList(){

        $("#example").dataTable().fnDraw(false);//按钮 点击事件触发table重新请求服务器
    }

    function deleteMenu(id){


        bootbox.dialog({
            message: "删除信息",
            title: "信息提示",
            buttons: {
                success: {
                    label: "取消",
                    className: "btn-default",
                    callback: function() {
                        alert();
                    }
                },
                danger: {
                    label: "删除",
                    className: "btn-danger",
                    callback: function() {
                        $.post(
                            "http://localhost:8080/movie/delete",
                            {"id":id},
                            function (data) {
                                if(data.status==200){
                                    queryList();

                                } else {
                                    bootbox.alert(
                                        "系统异常，请联系管理员",function() {

                                        }
                                    )
                                }
                            }
                        )
                    }
                },

            }
        });

    }


</script>
<body>


<div class="col-md-12">

    <div class="col-md-9">         <form class="form-horizontal" id="searchForm">
        <div class="form-group">
            <label for="movieName" class="col-sm-2 control-label">电影名称</label>
            <div class="form-group col-sm-4">
                <input type="text" class="form-control" id="movieName" placeholder="Name">
            </div>
            <label for="selectType" class="col-sm-2 control-label">品牌</label>
            <div class="col-sm-2" >
                <select class="form-control" id="selectType" name="类型">
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Date</label>
            <div class="form-group col-sm-4">
                <div class="input-group">
                    <input type="text" autocomplete="off" id="minDate" class="form-control" placeholder="年/月/日" aria-describedby="sizing-addon1">
                    <span class="input-group-addon glyphicon glyphicon-calendar" id="sizing-addon2"></span>
                    <input type="text" autocomplete="off" id="maxDate" class="form-control" placeholder="年/月/日" aria-describedby="sizing-addon1">
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">状态:</label>
                <label class="radio-inline">
                    <input type="radio" name="add_country"  value="1">国语影片
                </label>
                <label class="radio-inline">
                    <input type="radio" name="add_country" value="2">外语影片
                </label>
                <br>

            </div>
        </div>




        <div class="form-group ">
            <div class="col-sm-offset-5 col-sm-7 ">
                <button type="button" onclick="queryList()" class="btn btn-primary"><li class="glyphicon glyphicon-ok" ></li>&nbsp;Submit</button>
                &nbsp;
                <button type="reset" class="btn btn-info"><li class="glyphicon glyphicon-repeat" ></li>&nbsp;Reset</button>
            </div>
        </div>
    </form>
    </div>

    <div class="col-md-12" id="div1">

        <button type="button" class="btn btn-default" onclick="toAdd()">新增</button>

        <table id="example" class="table table-striped table-bordered" style="width:100%">
            <thead>
            <tr class="info">
                <td>id</td>
                <td>电影名称</td>
                <td>时长</td>
                <td>电影主图</td>
                <td>是否热映</td>
                <td>电影地区</td>
                <td>电影类型</td>
                <td>评分</td>
                <td>上映时间</td>
                <td>电影介绍</td>
                <td>创建时间</td>
                <td>修改时间</td>
                <td>事务</td>
            </tr>
            </thead>
            <tfoot>
            <tr class="info">
                <td>id</td>
                <td>电影名称</td>
                <td>时长</td>
                <td>电影主图</td>
                <td>是否热映</td>
                <td>电影地区</td>
                <td>电影类型</td>
                <td>评分</td>
                <td>上映时间</td>
                <td>电影介绍</td>
                <td>创建时间</td>
                <td>修改时间</td>
                <td>事务</td>
            </tr>
            </tfoot>
        </table></div>

</div>

</body>
</html>

